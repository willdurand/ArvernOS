<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArvernOS: src/kernel/arch/x86_64/mmu/paging.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ArvernOS
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('paging_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">paging.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="frame_8h.html">mmu/frame.h</a>&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;<a class="el" href="types_8h.html">sys/types.h</a>&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for paging.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h__incl.svg" width="400" height="276"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpage__entry__t.html">page_entry_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpage__table__t.html">page_table_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a28ff91b933f24d95e25ec5f03a736117"><td class="memItemLeft" align="right" valign="top"><a id="a28ff91b933f24d95e25ec5f03a736117" name="a28ff91b933f24d95e25ec5f03a736117"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PAGING_FLAG_PRESENT</b>&#160;&#160;&#160;(1 &lt;&lt; 0)</td></tr>
<tr class="memdesc:a28ff91b933f24d95e25ec5f03a736117"><td class="mdescLeft">&#160;</td><td class="mdescRight">Specifies whether the mapped page is loaded in memory. <br /></td></tr>
<tr class="separator:a28ff91b933f24d95e25ec5f03a736117"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adac89a5c7c54309cb4a4570d0f8cf75c"><td class="memItemLeft" align="right" valign="top"><a id="adac89a5c7c54309cb4a4570d0f8cf75c" name="adac89a5c7c54309cb4a4570d0f8cf75c"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PAGING_FLAG_WRITABLE</b>&#160;&#160;&#160;(1 &lt;&lt; 1)</td></tr>
<tr class="memdesc:adac89a5c7c54309cb4a4570d0f8cf75c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls whether writes to the mapped frames are allowed. <br /></td></tr>
<tr class="separator:adac89a5c7c54309cb4a4570d0f8cf75c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c235330203c88a6c6800a58a49cef17"><td class="memItemLeft" align="right" valign="top"><a id="a5c235330203c88a6c6800a58a49cef17" name="a5c235330203c88a6c6800a58a49cef17"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PAGING_FLAG_USER_ACCESSIBLE</b>&#160;&#160;&#160;(1 &lt;&lt; 2)</td></tr>
<tr class="memdesc:a5c235330203c88a6c6800a58a49cef17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Controls whether accesses from userspace (i.e. ring 3) are permitted. <br /></td></tr>
<tr class="separator:a5c235330203c88a6c6800a58a49cef17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b636c6433bad872f80f46458db566f7"><td class="memItemLeft" align="right" valign="top"><a id="a9b636c6433bad872f80f46458db566f7" name="a9b636c6433bad872f80f46458db566f7"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>PAGING_FLAG_NO_EXECUTE</b>&#160;&#160;&#160;((uint64_t)1 &lt;&lt; 63)</td></tr>
<tr class="memdesc:a9b636c6433bad872f80f46458db566f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forbids executing code on this page. <br /></td></tr>
<tr class="separator:a9b636c6433bad872f80f46458db566f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a569adfd13ea3c63741f64108821b1712"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a569adfd13ea3c63741f64108821b1712">paging_init</a> ()</td></tr>
<tr class="memdesc:a569adfd13ea3c63741f64108821b1712"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes paging to separate virtual and physical memory.  <a href="paging_8h.html#a569adfd13ea3c63741f64108821b1712">More...</a><br /></td></tr>
<tr class="separator:a569adfd13ea3c63741f64108821b1712"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a8869be87726e3c57c4856fc7b3531c"><td class="memItemLeft" align="right" valign="top">page_number_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a4a8869be87726e3c57c4856fc7b3531c">page_containing_address</a> (uint64_t virtual_address)</td></tr>
<tr class="separator:a4a8869be87726e3c57c4856fc7b3531c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96f5f0b5adaea47eda3e10c93401b2bf"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a96f5f0b5adaea47eda3e10c93401b2bf">page_start_address</a> (page_number_t page_number)</td></tr>
<tr class="separator:a96f5f0b5adaea47eda3e10c93401b2bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93e89a9ca57751d1b04f8d95ccbddb4b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structopt__uint64__t.html">opt_uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a93e89a9ca57751d1b04f8d95ccbddb4b">translate_page</a> (page_number_t page_number)</td></tr>
<tr class="separator:a93e89a9ca57751d1b04f8d95ccbddb4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f069c46ac4245771221fc7f0bcfb2e0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structopt__uint64__t.html">opt_uint64_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a1f069c46ac4245771221fc7f0bcfb2e0">translate</a> (uint64_t virtual_address)</td></tr>
<tr class="separator:a1f069c46ac4245771221fc7f0bcfb2e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af55681dc6c9ebb94b26ea497afe673f8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#af55681dc6c9ebb94b26ea497afe673f8">map</a> (page_number_t page_number, uint64_t flags)</td></tr>
<tr class="separator:af55681dc6c9ebb94b26ea497afe673f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a623291cd42facbd946e92e5307abe313"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a623291cd42facbd946e92e5307abe313">map_multiple</a> (page_number_t start_page_number, uint32_t number_of_pages, uint64_t flags)</td></tr>
<tr class="separator:a623291cd42facbd946e92e5307abe313"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2556847794baa9bcb9be757f7f67f6b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a2556847794baa9bcb9be757f7f67f6b4">unmap</a> (page_number_t page_number)</td></tr>
<tr class="separator:a2556847794baa9bcb9be757f7f67f6b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4d9db68debae8e51bab96105966d07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#aaf4d9db68debae8e51bab96105966d07">unmap_multiple</a> (page_number_t start_page_number, uint32_t number_of_pages)</td></tr>
<tr class="separator:aaf4d9db68debae8e51bab96105966d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd78a6bfbdc7cbbe0e578e52eccad8bf"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#acd78a6bfbdc7cbbe0e578e52eccad8bf">paging_amount_for_byte_size</a> (uint64_t start_address, uint64_t byte_size)</td></tr>
<tr class="separator:acd78a6bfbdc7cbbe0e578e52eccad8bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fe6ae7a3d76ec54afbc3a0b484f5804"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="paging_8h.html#a0fe6ae7a3d76ec54afbc3a0b484f5804">identity_map</a> (uint64_t address, uint64_t flags)</td></tr>
<tr class="separator:a0fe6ae7a3d76ec54afbc3a0b484f5804"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a0fe6ae7a3d76ec54afbc3a0b484f5804" name="a0fe6ae7a3d76ec54afbc3a0b484f5804"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fe6ae7a3d76ec54afbc3a0b484f5804">&#9670;&nbsp;</a></span>identity_map()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void identity_map </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Maps a page (virtual address) to the equivalent frame (physical address).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">address</td><td>the address to map </td></tr>
    <tr><td class="paramname">flags</td><td>paging flags </td></tr>
  </table>
  </dd>
</dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a0fe6ae7a3d76ec54afbc3a0b484f5804_cgraph.svg" width="331" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af55681dc6c9ebb94b26ea497afe673f8" name="af55681dc6c9ebb94b26ea497afe673f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af55681dc6c9ebb94b26ea497afe673f8">&#9670;&nbsp;</a></span>map()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void map </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>page_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Convenient function to map a page (number) without providing a frame. The frame is automatically allocated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page_number</td><td>a page number (not an address) </td></tr>
    <tr><td class="paramname">flags</td><td>paging flags </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a623291cd42facbd946e92e5307abe313" name="a623291cd42facbd946e92e5307abe313"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a623291cd42facbd946e92e5307abe313">&#9670;&nbsp;</a></span>map_multiple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void map_multiple </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>start_page_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>number_of_pages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Maps multiple pages in a row if possible.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_page_number</td><td>the first page of the sequence </td></tr>
    <tr><td class="paramname">number_of_pages</td><td>the amount of pages to map </td></tr>
    <tr><td class="paramname">flags</td><td>the paging flags </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4a8869be87726e3c57c4856fc7b3531c" name="a4a8869be87726e3c57c4856fc7b3531c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a8869be87726e3c57c4856fc7b3531c">&#9670;&nbsp;</a></span>page_containing_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">page_number_t page_containing_address </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>virtual_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns a page number given a virtual address.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">virtual_address</td><td>a virtual address (page) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a page number </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a4a8869be87726e3c57c4856fc7b3531c_icgraph.svg" width="434" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a96f5f0b5adaea47eda3e10c93401b2bf" name="a96f5f0b5adaea47eda3e10c93401b2bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96f5f0b5adaea47eda3e10c93401b2bf">&#9670;&nbsp;</a></span>page_start_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t page_start_address </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>page_number</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Returns the virtual start address of a page.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page_number</td><td>a page number </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a virtual address (page) </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a96f5f0b5adaea47eda3e10c93401b2bf_icgraph.svg" width="262" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="acd78a6bfbdc7cbbe0e578e52eccad8bf" name="acd78a6bfbdc7cbbe0e578e52eccad8bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd78a6bfbdc7cbbe0e578e52eccad8bf">&#9670;&nbsp;</a></span>paging_amount_for_byte_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t paging_amount_for_byte_size </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>start_address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>byte_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Calculates how many pages are needed for a range of addresses.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_address</td><td>the starting virtual address </td></tr>
    <tr><td class="paramname">byte_size</td><td>the amount of bytes </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the amount of pages required for mapping from start_address until start_address + byte_size </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_acd78a6bfbdc7cbbe0e578e52eccad8bf_cgraph.svg" width="434" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a569adfd13ea3c63741f64108821b1712" name="a569adfd13ea3c63741f64108821b1712"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a569adfd13ea3c63741f64108821b1712">&#9670;&nbsp;</a></span>paging_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void paging_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes paging to separate virtual and physical memory. </p>
<p >The bootloader (assembly code) already set up a 4-level paging hierarchy that maps every page of our kernel to a physical frame. It does this because paging is mandatory in 64-bit mode on x86_64.</p>
<p >This means that every memory address that we used in our kernel was a virtual address. Accessing the VGA buffer at address <code>0xb8000</code> only worked because the bootloader identity mapped that memory page, which means that it mapped the virtual page <code>0xb8000</code> to the physical frame <code>0xb8000</code>.</p>
<p >In addition, this improves safety since illegal memory accesses cause page fault exceptions instead of modifying arbitrary physical memory. That being said, identity mapping clutters the virtual address space and makes it more difficult to find continuous memory regions of larger sizes (like 1000â€¯KiB).</p>
<p >We remap the kernel and other useful sections/addresses in this function, then we enable write protection, the NXE bit and we switch to our own table. This allows us to make everything safer. Memory is still identity mapped, which isn't great but it works for now. </p>

</div>
</div>
<a id="a1f069c46ac4245771221fc7f0bcfb2e0" name="a1f069c46ac4245771221fc7f0bcfb2e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f069c46ac4245771221fc7f0bcfb2e0">&#9670;&nbsp;</a></span>translate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structopt__uint64__t.html">opt_uint64_t</a> translate </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>virtual_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Translates a virtual address to the corresponding physical address.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">virtual_address</td><td>a virtual address </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a physical address (optional) </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a1f069c46ac4245771221fc7f0bcfb2e0_cgraph.svg" width="307" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a93e89a9ca57751d1b04f8d95ccbddb4b" name="a93e89a9ca57751d1b04f8d95ccbddb4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93e89a9ca57751d1b04f8d95ccbddb4b">&#9670;&nbsp;</a></span>translate_page()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structopt__uint64__t.html">opt_uint64_t</a> translate_page </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>page_number</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Translates a page number to a frame number.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page_number</td><td>a page number (not an address) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>a frame number (optional) </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a93e89a9ca57751d1b04f8d95ccbddb4b_icgraph.svg" width="243" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2556847794baa9bcb9be757f7f67f6b4" name="a2556847794baa9bcb9be757f7f67f6b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2556847794baa9bcb9be757f7f67f6b4">&#9670;&nbsp;</a></span>unmap()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unmap </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>page_number</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Unmaps (free) a page.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">page_number</td><td>a page number (not an address) </td></tr>
  </table>
  </dd>
</dl>
<p >Do not call <code><a class="el" href="paging_8h.html#a1f069c46ac4245771221fc7f0bcfb2e0">translate()</a></code> here, otherwise our test suite wouldn't be able</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="paging_8h_a2556847794baa9bcb9be757f7f67f6b4_cgraph.svg" width="262" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaf4d9db68debae8e51bab96105966d07" name="aaf4d9db68debae8e51bab96105966d07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf4d9db68debae8e51bab96105966d07">&#9670;&nbsp;</a></span>unmap_multiple()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void unmap_multiple </td>
          <td>(</td>
          <td class="paramtype">page_number_t&#160;</td>
          <td class="paramname"><em>start_page_number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>number_of_pages</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Unmaps multiple consecutive pages.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_page_number</td><td>the first page of the sequence </td></tr>
    <tr><td class="paramname">number_of_pages</td><td>the amount of pages to unmap </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_cbd7f246bdf7dc0a50281a272327e6ed.html">kernel</a></li><li class="navelem"><a class="el" href="dir_76e3dd4d2fa719e8d3b096e9aa563982.html">arch</a></li><li class="navelem"><a class="el" href="dir_7c4c796ec9937bed8074dafcec3d25e4.html">x86_64</a></li><li class="navelem"><a class="el" href="dir_3a646564ec239f35c01425f0e9da2ba2.html">mmu</a></li><li class="navelem"><a class="el" href="paging_8h.html">paging.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
